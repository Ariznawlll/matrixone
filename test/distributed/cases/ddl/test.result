drop database if exists test;
create database test;
use test;
drop table if exists retention01;
create table retention01 (col1 int auto_increment, col2 decimal) with retention period 5 second;
insert into retention01 values (1, 2);
insert into retention01 values (2, 100);
insert into retention01 values (3, null);
select * from retention01;
col1    col2
1    2
2    100
3    null
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
test    retention01    1725951474
select sleep(5);
sleep(5)
0
select mo_ctl('cn', 'task', ':retention');
mo_ctl(cn, task, :retention)
{\n  "method": "TASK",\n  "result": {\n    "RequestID": 7,\n    "CmdMethod": 13,\n    "RunTask": {\n      "Result": "OK"\n    },\n    "GetReplicaCount": {},\n    "GoMaxProcsResponse": {},\n    "GoMemLimitResponse": {},\n    "FileServiceCacheResponse": {},\n    "FileServiceCacheEvictResponse": {}\n  }\n}\n
select sleep(1);
sleep(1)
0
show tables;
Tables_in_test
select * from retention01;
SQL parser error: table "retention01" does not exist
drop table retention01;
no such table test.retention01
drop table if exists retention02;
create table retention02(col1 int primary key , col2 decimal, col3 char, col4 varchar(20), col5 text, col6 double) with retention period 3 second;
insert into retention02 values (1, 2, 'a', '23eiojf', 'r23v324r23rer', 3923.324);
insert into retention02 values (2, 3, 'b', '32r32r', 'database', 1111111);
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
test    retention02    1725951478
select sleep(3);
sleep(3)
0
select mo_ctl('cn', 'task', ':retention');
mo_ctl(cn, task, :retention)
{\n  "method": "TASK",\n  "result": {\n    "RequestID": 8,\n    "CmdMethod": 13,\n    "RunTask": {\n      "Result": "OK"\n    },\n    "GetReplicaCount": {},\n    "GoMaxProcsResponse": {},\n    "GoMemLimitResponse": {},\n    "FileServiceCacheResponse": {},\n    "FileServiceCacheEvictResponse": {}\n  }\n}\n
select sleep(1);
sleep(1)
0
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
drop table if exists retention02;
drop table if exists retention03;
create table retention03 (
emp_no      int             not null,
birth_date  date            not null,
first_name  varchar(14)     not null,
last_name   varchar(16)     not null,
gender      varchar(5)      not null,
hire_date   date            not null,
primary key (emp_no)
) with retention period 10 second
partition by range columns (emp_no)(
partition p01 values less than (100001),
partition p02 values less than (200001),
partition p03 values less than (300001),
partition p04 values less than (400001)
);
insert into retention03 values (9001,'1980-12-17', 'SMITH', 'CLERK', 'F', '2008-12-17'),
(9002,'1981-02-20', 'ALLEN', 'SALESMAN', 'F', '2008-02-20');
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
test    retention03    1725951489
drop table retention03;
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
show tables;
Tables_in_test
drop table if exists retention04;
create table retention04 (
id int primary key ,
order_number varchar(20),
status enum('Pending', 'Processing', 'Completed', 'Cancelled')
) with retention period 5 second;
insert into retention04 values(1,'111',1),(2,'222',2),(3,'333',3),(4,'444','Cancelled');
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
test    retention04    1725951484
drop database test;
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
use mo_catalog;
drop table if exists retention05;
create cluster table retention05 (a int) with retention period 3 second;
insert into retention05 values(0, 0),(1, 0),(2, 0),(3, 0);
insert into retention05 values(0, 1),(1, 1),(2, 1),(3, 1);
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
mo_catalog    retention05    1725951483
select sleep(3);
sleep(3)
0
select mo_ctl('cn', 'task', ':retention');
mo_ctl(cn, task, :retention)
{\n  "method": "TASK",\n  "result": {\n    "RequestID": 9,\n    "CmdMethod": 13,\n    "RunTask": {\n      "Result": "OK"\n    },\n    "GetReplicaCount": {},\n    "GoMaxProcsResponse": {},\n    "GoMemLimitResponse": {},\n    "FileServiceCacheResponse": {},\n    "FileServiceCacheEvictResponse": {}\n  }\n}\n
select sleep(1);
sleep(1)
0
select * from mo_catalog.mo_retention;
database_name    table_name    retention_deadline
